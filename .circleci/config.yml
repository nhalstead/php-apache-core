version: 2.1
workflows:
  version: 2
  build:
    jobs:
      # Tag this build process in Docker Hub, Only apply to development, master, production branches
      - build80:
          filters:
            branches:
              only:
                - main
      # Tag this build process in Docker Hub, Only apply to development, master, production branches
      - build74:
          filters:
            branches:
              only:
                - main
jobs:
  build80:
    resource_class: small
    docker:
      - image: docker:20-git
    environment:
      # Define the Docker Hub Path to Push the Image
      IMAGE_PATH: "nhalstead00/php-apache-core"
      TAG_PREFIX: "8.0-"
    steps:
      - checkout
      - setup_remote_docker:
          docker_layer_caching: false
      - run:
          name: Install Bash
          command: apk update && apk add bash
      - run:
          name: Push Docker Image to Docker Hub Registry
          command: |
            cd 8.0
            bash ~/project/.circleci/registry_push.sh
  build74:
    resource_class: small
    docker:
      - image: docker:20-git
    environment:
      # Define the Docker Hub Path to Push the Image
      IMAGE_PATH: "nhalstead00/php-apache-core"
      TAG_PREFIX: "7.4-"
    steps:
      - checkout
      - setup_remote_docker:
          docker_layer_caching: false
      - run:
          name: Install Bash
          command: apk update && apk add bash
      - run:
          name: Push Docker Image to Docker Hub Registry
          command: |
            cd 7.4
            bash ~/project/.circleci/registry_push.sh